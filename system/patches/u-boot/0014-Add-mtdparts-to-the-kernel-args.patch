From eb45a2952ab0c4d2f83bb0db888b4dfe1026f642 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bc=2E=20Vladislav=20Mlejneck=C3=BD?= <v.mlejnecky@seznam.cz>
Date: Sun, 10 Sep 2023 15:57:18 +0200
Subject: [PATCH 14/15] Add mtdparts to the kernel args

---
 board/st/stm32f446-stlinux/stlinux.env | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/board/st/stm32f446-stlinux/stlinux.env b/board/st/stm32f446-stlinux/stlinux.env
index 4270a56bd5..6b28865927 100644
--- a/board/st/stm32f446-stlinux/stlinux.env
+++ b/board/st/stm32f446-stlinux/stlinux.env
@@ -1,7 +1,7 @@
-bootargs=console=ttySTM0,115200n8 earlycon=stm32,0x40004400 rdinit=/sbin/init
+set_args=setenv bootargs console=ttySTM0,115200n8 earlycon=stm32,0x40004400 rdinit=/sbin/init mtdparts=${mtdparts}
 kernel_addr_l=0xc1000000
 rootfs_addr_l=0xc1400000
 dtb_addr_l=0xc1c00000
-bootcmd=mtd read kernel ${kernel_addr_l}; mtd read rootfs ${rootfs_addr_l}; mtd read dtb ${dtb_addr_l}; bootz ${kernel_addr_l} ${rootfs_addr_l} ${dtb_addr_l}
-mtdids=nor0=qspi_nor0.0
-mtdparts=qspi_nor0.0:64k(dtb),4m(kernel),2m(rootfs),-(unused)
+bootcmd=mtd read kernel ${kernel_addr_l}; mtd read rootfs ${rootfs_addr_l}; mtd read dtb ${dtb_addr_l}; run set_args; bootz ${kernel_addr_l} ${rootfs_addr_l} ${dtb_addr_l}
+mtdids=nor0=spi0.0
+mtdparts=spi0.0:64k(dtb),4m(kernel),2m(rootfs),-(unused)
-- 
2.46.0

