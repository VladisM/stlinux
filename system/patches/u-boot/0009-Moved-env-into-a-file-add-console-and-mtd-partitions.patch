From 57fd66304a4c630b62e4192769376a805d0971ec Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bc=2E=20Vladislav=20Mlejneck=C3=BD?= <v.mlejnecky@seznam.cz>
Date: Sat, 27 May 2023 18:07:49 +0200
Subject: [PATCH 09/15] Moved env into a file, add console and mtd partitions

---
 board/st/stm32f446-stlinux/stlinux.env | 3 +++
 configs/stm32f446-stlinux_defconfig    | 4 ++++
 2 files changed, 7 insertions(+)
 create mode 100644 board/st/stm32f446-stlinux/stlinux.env

diff --git a/board/st/stm32f446-stlinux/stlinux.env b/board/st/stm32f446-stlinux/stlinux.env
new file mode 100644
index 0000000000..e5f327c36f
--- /dev/null
+++ b/board/st/stm32f446-stlinux/stlinux.env
@@ -0,0 +1,3 @@
+bootargs=console=ttySTM0,115200n8 earlycon=stm32,0x40004400 earlyprintk
+kernel_addr_l=0xc1000000
+dtb_addr_l=0xc1c00000
diff --git a/configs/stm32f446-stlinux_defconfig b/configs/stm32f446-stlinux_defconfig
index 1b92c1e2d3..111ec638ec 100644
--- a/configs/stm32f446-stlinux_defconfig
+++ b/configs/stm32f446-stlinux_defconfig
@@ -44,3 +44,7 @@ CONFIG_SF_DEFAULT_SPEED=10000000
 CONFIG_CMD_MTD=y
 CONFIG_SPI_FLASH_MTD=y
 CONFIG_SPI_FLASH_SFDP_SUPPORT=y
+CONFIG_MTDIDS_DEFAULT="nor0=qspi_nor0.0"
+CONFIG_MTDPARTS_DEFAULT="mtdparts=qspi_nor0.0:64k(dtb),2m(kernel),4m(rootfs),-(unused)"
+CONFIG_ENV_SOURCE_FILE="stlinux"
+CONFIG_CMD_BOOTZ=y
-- 
2.46.0

