From a8437181a101899e64553aeb37f9a6d2af9b18f2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bc=2E=20Vladislav=20Mlejneck=C3=BD?= <v.mlejnecky@seznam.cz>
Date: Fri, 21 Jul 2023 00:06:57 +0200
Subject: [PATCH 13/15] Update kernel args, add rdinit and make define MTD in
 env

---
 board/st/stm32f446-stlinux/stlinux.env | 4 +++-
 configs/stm32f446-stlinux_defconfig    | 2 --
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/board/st/stm32f446-stlinux/stlinux.env b/board/st/stm32f446-stlinux/stlinux.env
index 824cf8eb78..4270a56bd5 100644
--- a/board/st/stm32f446-stlinux/stlinux.env
+++ b/board/st/stm32f446-stlinux/stlinux.env
@@ -1,5 +1,7 @@
-bootargs=console=ttySTM0,115200n8 earlycon=stm32,0x40004400
+bootargs=console=ttySTM0,115200n8 earlycon=stm32,0x40004400 rdinit=/sbin/init
 kernel_addr_l=0xc1000000
 rootfs_addr_l=0xc1400000
 dtb_addr_l=0xc1c00000
 bootcmd=mtd read kernel ${kernel_addr_l}; mtd read rootfs ${rootfs_addr_l}; mtd read dtb ${dtb_addr_l}; bootz ${kernel_addr_l} ${rootfs_addr_l} ${dtb_addr_l}
+mtdids=nor0=qspi_nor0.0
+mtdparts=qspi_nor0.0:64k(dtb),4m(kernel),2m(rootfs),-(unused)
diff --git a/configs/stm32f446-stlinux_defconfig b/configs/stm32f446-stlinux_defconfig
index 22c6b1df9f..169f263802 100644
--- a/configs/stm32f446-stlinux_defconfig
+++ b/configs/stm32f446-stlinux_defconfig
@@ -24,8 +24,6 @@ CONFIG_CMD_IMLS=y
 CONFIG_CMD_MTD=y
 # CONFIG_CMD_SETEXPR is not set
 CONFIG_CMD_TIMER=y
-CONFIG_MTDIDS_DEFAULT="nor0=qspi_nor0.0"
-CONFIG_MTDPARTS_DEFAULT="mtdparts=qspi_nor0.0:64k(dtb),2m(kernel),4m(rootfs),-(unused)"
 CONFIG_OF_CONTROL=y
 CONFIG_OF_EMBED=y
 CONFIG_ENV_SOURCE_FILE="stlinux"
-- 
2.46.0

