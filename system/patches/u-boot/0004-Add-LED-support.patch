From e2ea66d87642c634ba7026fbdf0fac8a6788f559 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bc=2E=20Vladislav=20Mlejneck=C3=BD?= <v.mlejnecky@seznam.cz>
Date: Sun, 14 May 2023 18:52:34 +0200
Subject: [PATCH 04/15] Add LED support

---
 arch/arm/dts/stm32f446-stlinux.dts  | 15 ++++++++++++++-
 configs/stm32f446-stlinux_defconfig |  3 +++
 2 files changed, 17 insertions(+), 1 deletion(-)

diff --git a/arch/arm/dts/stm32f446-stlinux.dts b/arch/arm/dts/stm32f446-stlinux.dts
index 1f2432619a..6aa43dce76 100644
--- a/arch/arm/dts/stm32f446-stlinux.dts
+++ b/arch/arm/dts/stm32f446-stlinux.dts
@@ -17,6 +17,7 @@
 
 	chosen {
 		stdout-path = "serial0:115200n8";
+		tick-timer = "timers5";
 	};
 
 	memory@c0000000 {
@@ -27,6 +28,19 @@
 	aliases {
 		serial0 = &usart2;
 	};
+
+	leds {
+		compatible = "gpio-leds";
+		led_user_0 {
+			label = "led_user_0";
+			gpios = <&gpioc 13 1>;
+		};
+
+		led_user_1 {
+			label = "led_user_1";
+			gpios = <&gpioa 1 1>;
+		};
+	};
 };
 
 &clk_hse {
@@ -44,7 +58,6 @@
 };
 
 &timers5 {
-	/* Override timer5 to act as clockevent */
 	compatible = "st,stm32-timer";
 	interrupts = <50>;
 	status = "okay";
diff --git a/configs/stm32f446-stlinux_defconfig b/configs/stm32f446-stlinux_defconfig
index 32b596c425..8c0658b1b3 100644
--- a/configs/stm32f446-stlinux_defconfig
+++ b/configs/stm32f446-stlinux_defconfig
@@ -27,3 +27,6 @@ CONFIG_STM32_FLASH=y
 CONFIG_SYS_MAX_FLASH_SECT=6
 CONFIG_SYS_MAX_FLASH_BANKS=1
 CONFIG_SYS_CONSOLE_INFO_QUIET=y
+CONFIG_LED=y
+CONFIG_LED_GPIO=y
+CONFIG_CMD_LED=y
-- 
2.46.0

